# 運転日報アプリ

運転日報を簡単に記録・管理できるPWA（Progressive Web App）です。出発・経由・到着の記録をGPS情報と共に保存し、CSV形式でエクスポートできます。

## 主な機能

### 📝 記録機能
- **出発・経由・到着**の3つのアクションで記録を作成
- **GPS位置情報**を自動取得
- **行先**、**目的**、**ガソリンメーター**情報を記録
- 記録の個別削除機能
- 記録の編集機能（GPS座標以外の項目を編集可能）

### 📊 エクスポート機能
- **月別**または**日付範囲**でCSVエクスポート
- エクスポートしたCSVを**メールで送信**
- **AES-256-GCM暗号化**によるセキュアなメール送信
- **暗号化されたデータの復号化ツール**を内蔵
- Excelでそのまま開けるCSV形式

### 🔧 メンテナンス機能
- **Google マップ**から位置情報を指定して記録を作成
- 過去の日時を指定して記録を追加
- **アクションボタンのカスタマイズ**（表示/非表示、表示名、アクション名の変更）
- **パスフレーズ管理**（自動生成、再作成、コピー機能）
- **メール送信設定**（送信先アドレス、暗号化オプション）
- 全記録の一括削除（2段階確認）

### 🔐 セキュリティ機能
- **パスフレーズ**による端末識別（8文字のランダム文字列）
- **AES-256-GCM暗号化**でCSVデータを保護
- 暗号化のオン/オフ切り替え可能
- **復号化ツール**で暗号化されたデータを復元

### 📱 PWA機能
- **オフライン対応** - インターネット接続なしでも利用可能
- **インストール可能** - スマートフォンにアプリとしてインストール
- **レスポンシブデザイン** - スマートフォン、タブレット、PCに対応

## 使い方

### 基本的な使い方

1. **記録の作成**
   - 行先と目的を入力（出発時は必須）
   - ガソリンメーターの値を入力（出発時は必須）
   - 「出発」「経由」「到着」ボタンをタップ
   - GPS位置情報が自動的に記録されます

2. **記録の確認・編集**
   - 「記録一覧」タブで過去の記録を確認
   - 各記録をタップして編集（GPS座標以外）
   - 各記録の右上の「×」ボタンで個別削除

3. **データのエクスポート**
   - 「エクスポート」タブを選択
   - 月別または日付範囲を選択
   - 「CSVダウンロード」または「エクスポートしてメールで送信」をタップ

### メール送信の設定

1. **初回設定**
   - 「メンテナンス」タブを開く
   - 送信先メールアドレスを入力
   - 「メール設定を保存」をタップ

2. **暗号化設定**
   - 「メール送信時にパスフレーズで暗号化する」のチェックでオン/オフ
   - オンの場合、CSVデータがAES-256-GCMで暗号化されます

### 暗号化されたデータの復号化

1. 画面右下の「復号化ツールを起動」ボタンをタップ
2. パスフレーズを入力（メンテナンス画面で確認可能）
3. 暗号化されたデータを貼り付け
4. 「復号化」ボタンをタップ
5. 復号化されたデータをコピーまたはCSVファイルとしてダウンロード

### Google マップから記録を作成

1. Google マップで場所を検索
2. 地図上で右クリックして座標をコピー
3. 「メンテナンス」タブの「GPS座標」欄に貼り付け
4. その他の情報を入力して「記録を作成」をタップ

### アクションボタンのカスタマイズ

1. 「メンテナンス」タブの「アクション設定」セクション
2. 各アクション（出発/経由/到着）の設定を変更
   - 表示/非表示の切り替え
   - ボタンの表示名を変更
   - 記録時のアクション名を変更
3. 「設定を保存」をタップ

## インストール方法

### Webブラウザから利用

1. Webサーバーに全ファイルをアップロード
2. スマートフォンのブラウザでアクセス
3. 画面下部の「アプリをインストール」ボタンをタップ（またはブラウザのメニューから「ホーム画面に追加」）

### ローカル環境での動作確認

```bash
# Python 3の場合
python -m http.server 8000

# Python 2の場合
python -m SimpleHTTPServer 8000

# Node.jsの場合
npx http-server
```

ブラウザで `http://localhost:8000` にアクセス

## ファイル構成

```
DrivingReport/
├── index.html          # メインHTMLファイル
├── styles.css          # スタイルシート
├── app.js              # メインアプリケーションロジック
├── camera-ocr.js       # カメラOCR機能（実験的）
├── install-prompt.js   # PWAインストール処理
├── sw.js               # Service Worker（オフライン対応）
├── manifest.json       # PWAマニフェスト
├── icon-192x192.png    # アプリアイコン（192x192）
├── icon-512x512.png    # アプリアイコン（512x512）
├── create-icons.html   # アイコン生成ツール
└── README.md           # このファイル
```

## 技術仕様

### 使用技術
- HTML5
- CSS3
- JavaScript (ES6+)
- Service Worker API
- Geolocation API
- LocalStorage API
- Web Crypto API (AES-256-GCM暗号化)
- Tesseract.js (OCR機能・実験的)

### データ保存
- ブラウザのLocalStorageに保存
- オフラインでも動作可能
- データはブラウザのキャッシュクリアで削除される可能性あり

### セキュリティ
- AES-256-GCM暗号化アルゴリズムを使用
- Web Crypto APIによる安全な暗号化処理
- パスフレーズは8文字のランダム文字列（大文字・小文字・数字）

### 対応ブラウザ
- Chrome (Android/PC)
- Safari (iOS)
- Edge
- Firefox

## 注意事項

- GPS位置情報の取得には端末の位置情報サービスの許可が必要です
- HTTPSまたはlocalhostでのみPWA機能が利用可能です
- データはブラウザのLocalStorageに保存されるため、定期的なバックアップ（エクスポート）を推奨します

## ライセンス

このプロジェクトは個人利用を目的として作成されています。

## 更新履歴

- 2025年1月 - セキュリティ機能追加
  - AES-256-GCM暗号化機能を実装
  - パスフレーズ管理機能を追加
  - 暗号化されたデータの復号化ツールを追加
  - メール送信先の設定機能を追加
  - 記録の編集機能を追加
  - アクションボタンのカスタマイズ機能を追加

- 2024年 - 初版リリース
  - 基本的な記録機能
  - CSVエクスポート機能
  - PWA対応
  - メンテナンス機能追加